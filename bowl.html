<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì´ëª¨í‹°ì½˜ ë³¼ë§ ê²Œì„</title>
  <style>
    body { background: #222; color: #fff; text-align: center; }
    #gameCanvas { background: #333; display: block; margin: 0 auto; }
    .emoji-pin {
      position: absolute;
      font-size: 2.5rem;
      pointer-events: none;
      user-select: none;
    }
  </style>
</head>
<body>
  <h1>ì´ëª¨í‹°ì½˜ ë³¼ë§ ê²Œì„ ğŸ³</h1>
  <canvas id="gameCanvas" width="600" height="800"></canvas>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
  <script>
    // Matter.js ëª¨ë“ˆ
    const { Engine, Render, Runner, World, Bodies, Body, Events, Mouse, MouseConstraint } = Matter;

    // ì—”ì§„ê³¼ ì›”ë“œ ìƒì„±
    const engine = Engine.create();
    const world = engine.world;

    // ìº”ë²„ìŠ¤ ë Œë”ëŸ¬
    const canvas = document.getElementById('gameCanvas');
    const render = Render.create({
      canvas: canvas,
      engine: engine,
      options: {
        width: 600,
        height: 800,
        wireframes: false,
        background: '#333',
      }
    });
    Render.run(render);
    Runner.run(Runner.create(), engine);

    // ë°”ë‹¥, ë²½
    const ground = Bodies.rectangle(300, 790, 600, 20, { isStatic: true });
    const leftWall = Bodies.rectangle(10, 400, 20, 800, { isStatic: true });
    const rightWall = Bodies.rectangle(590, 400, 20, 800, { isStatic: true });
    World.add(world, [ground, leftWall, rightWall]);

    // ë³¼ë§í•€ ì´ëª¨í‹°ì½˜ ìœ„ì¹˜ ì €ì¥
    const pinEmojis = [];
    const pinBodies = [];
    const pinEmoji = 'ğŸ³'; // ì›í•˜ëŠ” ì´ëª¨í‹°ì½˜ìœ¼ë¡œ ë³€ê²½ ê°€ëŠ¥
    const pinRows = 4;
    let pinCount = 0;
    for (let row = 0; row < pinRows; row++) {
      for (let i = 0; i <= row; i++) {
        const x = 300 + (i - row / 2) * 40;
        const y = 200 + row * 45;
        const pin = Bodies.rectangle(x, y, 30, 40, {
          label: 'pin',
          restitution: 0.4,
          render: { visible: false }
        });
        pinBodies.push(pin);
        pinEmojis.push({ x, y, body: pin });
        World.add(world, pin);
        pinCount++;
      }
    }

    // ë³¼ë§ê³µ
    const ball = Bodies.circle(300, 700, 30, {
      label: 'ball',
      restitution: 0.7,
      render: { fillStyle: '#fff' }
    });
    World.add(world, ball);

    // ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ë¡œ ë³¼ë§ê³µ ë°œì‚¬
    const mouse = Mouse.create(render.canvas);
    const mouseConstraint = MouseConstraint.create(engine, {
      mouse: mouse,
      constraint: {
        stiffness: 0.2,
        render: { visible: false }
      },
      collisionFilter: {
        mask: 0x0001
      }
    });
    World.add(world, mouseConstraint);
    render.mouse = mouse;

    // ë³¼ë§ê³µë§Œ ë“œë˜ê·¸ ê°€ëŠ¥í•˜ê²Œ
    Events.on(mouseConstraint, 'startdrag', function(event) {
      if (event.body !== ball) {
        mouseConstraint.constraint.bodyB = null;
      }
    });

    // ì´ëª¨í‹°ì½˜ í•€ ê·¸ë¦¬ê¸°
    function drawPins() {
      const ctx = render.context;
      ctx.font = '2.5rem serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      for (const pin of pinEmojis) {
        ctx.save();
        ctx.translate(pin.body.position.x, pin.body.position.y);
        ctx.rotate(pin.body.angle);
        ctx.globalAlpha = pin.body.speed > 0.1 ? 0.7 : 1;
        ctx.fillText(pinEmoji, 0, 0);
        ctx.restore();
      }
    }

    // ë Œë” í›„ ì´ëª¨í‹°ì½˜ í•€ ê·¸ë¦¬ê¸°
    Events.on(render, 'afterRender', function() {
      drawPins();
    });

    // ë¦¬ì…‹ ê¸°ëŠ¥ (í•„ìš”ì‹œ)
    function resetGame() {
      Body.setPosition(ball, { x: 300, y: 700 });
      Body.setVelocity(ball, { x: 0, y: 0 });
      Body.setAngularVelocity(ball, 0);
      for (let i = 0; i < pinBodies.length; i++) {
        Body.setPosition(pinBodies[i], { x: pinEmojis[i].x, y: pinEmojis[i].y });
        Body.setVelocity(pinBodies[i], { x: 0, y: 0 });
        Body.setAngle(pinBodies[i], 0);
        Body.setAngularVelocity(pinBodies[i], 0);
      }
    }
    // Rí‚¤ë¡œ ë¦¬ì…‹
    window.addEventListener('keydown', (e) => {
      if (e.key === 'r' || e.key === 'R') resetGame();
    });
  </script>
</body>
</html>
