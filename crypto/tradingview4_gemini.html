<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‡°ğŸ‡· ê¹€ì¹˜í”„ë¦¬ë¯¸ì—„ ì‹¤ì‹œê°„ ì°¨íŠ¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://s3.tradingview.com/tv.js"></script>
    <style>
        /*
        * ----------------------------------------
        * CSS Styles
        * ----------------------------------------
        */

        :root {
            --bg-start: #667eea;
            --bg-end: #764ba2;
            --card-bg: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --color-positive: #10b981; /* ì´ˆë¡ìƒ‰ */
            --color-negative: #ef4444; /* ë¹¨ê°„ìƒ‰ */
            --color-neutral: #374151; /* ì§„í•œ íšŒìƒ‰ */
            --color-primary: #667eea; /* ë²„íŠ¼ ê¸°ë³¸ìƒ‰ */
            --color-hover: #5a68d0; /* ë²„íŠ¼ í˜¸ë²„ìƒ‰ */
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%);
            color: var(--color-neutral);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- Header & Typography --- */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .header .formula {
            font-size: 0.9rem;
            padding: 8px 15px;
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            display: inline-block;
            margin-top: 15px;
            font-weight: 600;
        }

        /* --- Coin Selection Buttons --- */
        .coin-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .coin-button {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px; /* ë‘¥ê·¼ ì•Œì•½ ëª¨ì–‘ */
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.1s;
        }

        .coin-button:hover {
            background-color: var(--color-hover);
        }

        .coin-button.active {
            background-color: var(--color-primary);
            box-shadow: 0 4px 10px var(--shadow-color);
        }

        /* --- Statistics Cards --- */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px var(--shadow-color);
            text-align: center;
        }

        .stat-card h3 {
            font-size: 1rem;
            color: #6b7280;
            margin-top: 0;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            word-break: break-word;
        }
        
        .premium-status {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 5px;
        }

        .positive { color: var(--color-positive); }
        .negative { color: var(--color-negative); }
        .neutral { color: var(--color-neutral); }

        /* --- Chart Area --- */
        .chart-area {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px var(--shadow-color);
            margin-bottom: 30px;
        }
        
        .chart-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }

        /* Main Chart (Kimchi Premium) */
        #kimchi-premium-chart {
            height: 900px; /* ë°ìŠ¤í¬í†± ê¸°ë³¸ ë†’ì´ */
            min-height: 500px; /* ìµœì†Œ ë†’ì´ ë³´ì¥ */
        }
        
        /* Comparison Charts */
        .comparison-charts {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2ì—´ ê·¸ë¦¬ë“œ */
            gap: 20px;
            margin-top: 30px;
        }

        .comparison-chart-item {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px var(--shadow-color);
        }
        
        .comparison-chart-item .chart-title {
            font-size: 1.25rem;
        }
        
        .upbit-chart, .binance-chart {
            height: 600px; /* ë°ìŠ¤í¬í†± ê¸°ë³¸ ë†’ì´ */
            min-height: 400px; /* ìµœì†Œ ë†’ì´ ë³´ì¥ */
        }

        /* --- Footer --- */
        .footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            padding: 15px 0;
        }

        /* --- Responsive Design (Media Queries) --- */
        @media (max-width: 1024px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }
            
            .stat-value {
                font-size: 2rem;
            }

            #kimchi-premium-chart {
                height: 700px; 
            }
            
            .upbit-chart, .binance-chart {
                height: 500px; 
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .coin-button {
                padding: 8px 15px;
                font-size: 0.9rem;
            }

            .stats-grid {
                grid-template-columns: 1fr; /* ëª¨ë°”ì¼ì—ì„œ 1ì—´ */
            }

            #kimchi-premium-chart {
                height: 500px; /* ëª¨ë°”ì¼ ë†’ì´ */
                min-height: 400px;
            }

            .comparison-charts {
                grid-template-columns: 1fr; /* ëª¨ë°”ì¼ì—ì„œ 1ì—´ */
            }
            
            .upbit-chart, .binance-chart {
                height: 400px; /* ëª¨ë°”ì¼ ë†’ì´ */
                min-height: 300px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <h1>ğŸ‡°ğŸ‡· ê¹€ì¹˜í”„ë¦¬ë¯¸ì—„ ì‹¤ì‹œê°„ ì°¨íŠ¸</h1>
            <p>TradingView ìŠ¤í”„ë ˆë“œ ì°¨íŠ¸ë¡œ ì§ì ‘ ê³„ì‚°</p>
            <div class="formula">
                ìˆ˜ì‹: ğŸ“Š (ì—…ë¹„íŠ¸KRW - ë°”ì´ë‚¸ìŠ¤USDT Ã— FX_IDC:USDKRW) Ã· (ë°”ì´ë‚¸ìŠ¤USDT Ã— FX_IDC:USDKRW) Ã— 100
            </div>
        </header>

        <section class="coin-selector" id="coin-selector">
            </section>

        <section class="stats-grid" id="stats-grid">
            <div class="stat-card">
                <h3>í˜„ì¬ ê¹€ì¹˜í”„ë¦¬ë¯¸ì—„</h3>
                <p class="stat-value" id="premium-percent">--</p>
                <p class="premium-status" id="premium-status">ë°ì´í„° ë¡œë”© ì¤‘...</p>
            </div>
            <div class="stat-card">
                <h3>ì—…ë¹„íŠ¸ (KRW)</h3>
                <p class="stat-value neutral" id="upbit-krw">--</p>
            </div>
            <div class="stat-card">
                <h3>ë°”ì´ë‚¸ìŠ¤ (USD/KRW)</h3>
                <p class="stat-value neutral" id="binance-usd-krw">--</p>
            </div>
            <div class="stat-card">
                <h3>í˜„ì¬ í™˜ìœ¨ (USD/KRW)</h3>
                <p class="stat-value neutral" id="current-exchange-rate">--</p>
            </div>
        </section>

        <section class="chart-area">
            <h2 class="chart-title">âœ… ê¹€ì¹˜í”„ë¦¬ë¯¸ì—„ (%) ì¼ë´‰ ì°¨íŠ¸</h2>
            <div id="kimchi-premium-chart"></div>

            <div class="comparison-charts">
                <div class="comparison-chart-item">
                    <h3 class="chart-title">ğŸ“ˆ ì—…ë¹„íŠ¸ KRW ê°€ê²© ì°¨íŠ¸</h3>
                    <div class="upbit-chart" id="upbit-chart"></div>
                </div>
                <div class="comparison-chart-item">
                    <h3 class="chart-title">ğŸŒ ë°”ì´ë‚¸ìŠ¤ USDT ê°€ê²© ì°¨íŠ¸</h3>
                    <div class="binance-chart" id="binance-chart"></div>
                </div>
            </div>
        </section>
    </div>

    <footer class="footer">
        TradingView ìŠ¤í”„ë ˆë“œ ì°¨íŠ¸ | ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ | íˆ¬ì íŒë‹¨ì˜ ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”
    </footer>

    <script>
        /*
        * ----------------------------------------
        * JavaScript Logic
        * ----------------------------------------
        */

        // ì½”ì¸ ë° ì‹¬ë³¼ ë§¤í•‘
        const COINS = {
            'BTC': { name: 'ë¹„íŠ¸ì½”ì¸', upbit: 'UPBIT:BTCKRW', binance: 'BINANCE:BTCUSDT' },
            'ETH': { name: 'ì´ë”ë¦¬ì›€', upbit: 'UPBIT:ETHKRW', binance: 'BINANCE:ETHUSDT' },
            'XRP': { name: 'ë¦¬í”Œ', upbit: 'UPBIT:XRPKRW', binance: 'BINANCE:XRPUSDT' },
            'SOL': { name: 'ì†”ë¼ë‚˜', upbit: 'UPBIT:SOLKRW', binance: 'BINANCE:SOLUSDT' },
            'ADA': { name: 'ì—ì´ë‹¤', upbit: 'UPBIT:ADAKRW', binance: 'BINANCE:ADAUSDT' },
            'DOGE': { name: 'ë„ì§€ì½”ì¸', upbit: 'UPBIT:DOGEKRW', binance: 'BINANCE:DOGEUSDT' },
        };
        const EXCHANGE_SYMBOL = 'FX_IDC:USDKRW'; // TradingView ê³µì‹ í™˜ìœ¨ ì‹¬ë³¼
        let currentCoin = 'BTC'; // ê¸°ë³¸ ì½”ì¸ ì„¤ì •
        let tvWidget = null;

        // TradingView ì°¨íŠ¸ ê¸°ë³¸ ì„¤ì •
        const TV_WIDGET_DEFAULTS = {
            interval: 'D', // ì¼ë´‰
            timezone: 'Asia/Seoul',
            theme: 'light',
            locale: 'ko',
            autosize: true,
            toolbar_bg: '#f1f3f6',
            enable_publishing: false,
            allow_symbol_change: false, // ì‹¬ë³¼ ë³€ê²½ ë¹„í™œì„±í™”
            hide_side_toolbar: true,
            withdateranges: true,
            studies: [
                { id: "MAExp@tv-basicstudies", inputs: { length: 20 } }, // 20ì¼ ì´ë™í‰ê· ì„ 
                { id: "BB@tv-basicstudies" } // ë³¼ë¦°ì € ë°´ë“œ
            ]
        };

        /**
         * TradingView ìœ„ì ¯ì„ ì´ˆê¸°í™”í•˜ê³  DOMì— ì‚½ì…í•©ë‹ˆë‹¤.
         * @param {string} symbol - TradingView ì‹¬ë³¼ (ìˆ˜ì‹ ë˜ëŠ” ì¼ë°˜ ì‹¬ë³¼)
         * @param {string} containerId - ì°¨íŠ¸ê°€ ë“¤ì–´ê°ˆ DOM ID
         * @param {string} chartType - ì°¨íŠ¸ ìœ í˜• ('premium', 'price')
         */
        function createTradingViewWidget(symbol, containerId, chartType) {
            const container = document.getElementById(containerId);
            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±° (ì°Œê·¸ëŸ¬ì§ ë°©ì§€ ë° ì¬ìƒì„±)
            container.innerHTML = ''; 

            new TradingView.widget({
                ...TV_WIDGET_DEFAULTS,
                symbol: symbol,
                container: containerId,
                height: chartType === 'premium' ? (window.innerWidth <= 768 ? 500 : 900) : (window.innerWidth <= 768 ? 400 : 600),
                // premium ì°¨íŠ¸ì—ë§Œ ìˆ˜ì‹ ê´€ë ¨ ì¶”ê°€ ì„¤ì •
                ...(chartType === 'premium' && {
                    studies: [], // ìŠ¤í”„ë ˆë“œ ì°¨íŠ¸ì—ì„œëŠ” ì§€í‘œ ì œê±°
                    range: 'ALL',
                    range_selection: true,
                    // custom_formatters: { time: (t) => new Date(t * 1000).toLocaleString('ko-KR', { dateStyle: 'short' }) }
                })
            });
        }

        /**
         * ì„ íƒëœ ì½”ì¸ì— ë§ì¶° TradingView ì°¨íŠ¸ 3ê°œë¥¼ ëª¨ë‘ ë¡œë“œí•©ë‹ˆë‹¤.
         */
        function loadCharts(coin) {
            const coinData = COINS[coin];
            if (!coinData) return;

            // 1. ê¹€ì¹˜í”„ë¦¬ë¯¸ì—„ ìŠ¤í”„ë ˆë“œ ì°¨íŠ¸ (ìˆ˜ì‹ ì ìš©)
            // ìˆ˜ì‹: (UPBIT:KRW - BINANCE:USDT * FX_IDC:USDKRW) / (BINANCE:USDT * FX_IDC:USDKRW) * 100
            const kimchiFormula = `((${coinData.upbit} - (${coinData.binance} * ${EXCHANGE_SYMBOL})) / (${coinData.binance} * ${EXCHANGE_SYMBOL})) * 100`;
            createTradingViewWidget(kimchiFormula, 'kimchi-premium-chart', 'premium');

            // 2. ì—…ë¹„íŠ¸ KRW ê°€ê²© ì°¨íŠ¸
            createTradingViewWidget(coinData.upbit, 'upbit-chart', 'price');

            // 3. ë°”ì´ë‚¸ìŠ¤ USDT ê°€ê²© ì°¨íŠ¸
            createTradingViewWidget(coinData.binance, 'binance-chart', 'price');
        }

        /**
         * ì‹¤ì‹œê°„ APIë¥¼ í˜¸ì¶œí•˜ì—¬ í†µê³„ ì¹´ë“œë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        async function updateStats() {
            const coin = currentCoin;
            const upbitCode = `KRW-${coin}`;
            const binanceCode = `${coin}USDT`;
            
            // API ì—”ë“œí¬ì¸íŠ¸
            const upbitApiUrl = `https://api.upbit.com/v1/ticker?markets=${upbitCode}`;
            const binanceApiUrl = `https://api.binance.com/api/v3/ticker/price?symbol=${binanceCode}`;
            const exchangeApiUrl = 'https://open.er-api.com/v6/latest/USD';

            let upbitPrice = 0;
            let binancePriceUSD = 0;
            let exchangeRate = 0;

            try {
                // 1. í™˜ìœ¨ API í˜¸ì¶œ
                const exchangeResponse = await fetch(exchangeApiUrl);
                const exchangeData = await exchangeResponse.json();
                exchangeRate = exchangeData.rates.KRW;
                document.getElementById('current-exchange-rate').textContent = `${exchangeRate.toFixed(2)} KRW`;

                // 2. ì—…ë¹„íŠ¸ API í˜¸ì¶œ
                const upbitResponse = await fetch(upbitApiUrl);
                const upbitData = await upbitResponse.json();
                upbitPrice = upbitData[0].trade_price;
                document.getElementById('upbit-krw').textContent = `${upbitPrice.toLocaleString()} KRW`;

                // 3. ë°”ì´ë‚¸ìŠ¤ API í˜¸ì¶œ
                const binanceResponse = await fetch(binanceApiUrl);
                const binanceData = await binanceResponse.json();
                binancePriceUSD = parseFloat(binanceData.price);
                
                // ë°”ì´ë‚¸ìŠ¤ KRW í™˜ì‚° ê°€ê²© ê³„ì‚°
                const binancePriceKRW = binancePriceUSD * exchangeRate;
                document.getElementById('binance-usd-krw').textContent = `${binancePriceUSD.toFixed(2)} USD / ${binancePriceKRW.toLocaleString()} KRW`;

                // 4. ê¹€ì¹˜í”„ë¦¬ë¯¸ì—„ ê³„ì‚°
                // ìˆ˜ì‹: (ì—…ë¹„íŠ¸KRW - ë°”ì´ë‚¸ìŠ¤KRW) / ë°”ì´ë‚¸ìŠ¤KRW * 100
                const premium = ((upbitPrice - binancePriceKRW) / binancePriceKRW) * 100;

                // 5. í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
                updatePremiumDisplay(premium);

            } catch (error) {
                console.error('API ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                document.getElementById('premium-status').textContent = 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨';
            }
        }

        /**
         * ê¹€ì¹˜í”„ë¦¬ë¯¸ì—„ ê°’ì— ë”°ë¼ í…ìŠ¤íŠ¸ì™€ ìƒ‰ìƒì„ ë³€ê²½í•©ë‹ˆë‹¤.
         * @param {number} premium - ê¹€ì¹˜í”„ë¦¬ë¯¸ì—„ ê°’ (%)
         */
        function updatePremiumDisplay(premium) {
            const premiumEl = document.getElementById('premium-percent');
            const statusEl = document.getElementById('premium-status');
            
            premiumEl.textContent = `${premium.toFixed(2)} %`;
            premiumEl.className = 'stat-value'; // ì´ˆê¸°í™”

            let statusText = '';
            let statusClass = 'neutral';

            if (premium >= 5) {
                statusText = 'ğŸ”¥ ë§¤ìš° ë†’ì€ í”„ë¦¬ë¯¸ì—„';
                statusClass = 'positive';
            } else if (premium >= 2) {
                statusText = 'ğŸ“ˆ ë†’ì€ í”„ë¦¬ë¯¸ì—„';
                statusClass = 'positive';
            } else if (premium >= 0) {
                statusText = 'ğŸ“Š ë³´í†µ ìˆ˜ì¤€';
                statusClass = 'neutral';
            } else { // premium < 0
                statusText = 'ğŸ“‰ ë‚®ì€ í”„ë¦¬ë¯¸ì—„';
                statusClass = 'negative';
            }

            premiumEl.classList.add(statusClass);
            statusEl.textContent = statusText;
            statusEl.className = 'premium-status ' + statusClass;
        }

        /**
         * ì½”ì¸ ì„ íƒ ë²„íŠ¼ì„ ìƒì„±í•˜ê³  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
         */
        function createCoinButtons() {
            const selector = document.getElementById('coin-selector');
            Object.keys(COINS).forEach(coin => {
                const button = document.createElement('button');
                button.textContent = `${COINS[coin].name} (${coin})`;
                button.className = 'coin-button';
                button.dataset.coin = coin;

                button.addEventListener('click', () => {
                    // ëª¨ë“  ë²„íŠ¼ active í´ë˜ìŠ¤ ì œê±°
                    document.querySelectorAll('.coin-button').forEach(btn => btn.classList.remove('active'));
                    
                    // í˜„ì¬ ë²„íŠ¼ active í´ë˜ìŠ¤ ì¶”ê°€
                    button.classList.add('active');
                    
                    // ì„ íƒëœ ì½”ì¸ ì—…ë°ì´íŠ¸ ë° ì°¨íŠ¸/í†µê³„ ë¡œë“œ
                    currentCoin = coin;
                    loadCharts(currentCoin);
                    updateStats();
                });

                selector.appendChild(button);
            });
            
            // ê¸°ë³¸ ì½”ì¸ ë²„íŠ¼ í™œì„±í™”
            document.querySelector(`.coin-button[data-coin="${currentCoin}"]`).classList.add('active');
        }

        /**
         * í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” í•¨ìˆ˜
         */
        function init() {
            createCoinButtons();
            loadCharts(currentCoin); // ê¸°ë³¸ ì°¨íŠ¸ ë¡œë“œ
            updateStats(); // ì´ˆê¸° í†µê³„ ì—…ë°ì´íŠ¸

            // 30ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸ ì„¤ì •
            setInterval(updateStats, 30000); // 30000ms = 30ì´ˆ
        }

        // TradingView ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œëœ í›„ ì´ˆê¸°í™” ì‹¤í–‰
        window.addEventListener('load', init);
        
        // ì°½ í¬ê¸° ë³€ê²½ ì‹œ ì°¨íŠ¸ ë†’ì´ ì¡°ì • (ë°˜ì‘í˜• ëŒ€ì‘)
        window.addEventListener('resize', () => {
             // ì°¨íŠ¸ DOMì´ ì‚´ì•„ìˆë‹¤ë©´, ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì°¨íŠ¸ ë†’ì´ ì¬ì„¤ì •ì„ ìœ„í•´ ì¬ìƒì„±í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
             // TradingView ìœ„ì ¯ì€ ìì²´ì ìœ¼ë¡œ height ê°’ì„ window í¬ê¸°ì— ë”°ë¼ ì¡°ì •í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, 
             // DOMì„ ë¹„ìš°ê³  ë‹¤ì‹œ ìœ„ì ¯ì„ ìƒì„±í•´ì•¼ ì™„ë²½í•œ ë°˜ì‘í˜• ë†’ì´ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
             // í•˜ì§€ë§Œ ì´ëŠ” ì„±ëŠ¥ ì €í•˜ë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë¯¸ë””ì–´ ì¿¼ë¦¬ë¡œ CSS height/min-heightë¥¼ ì¡°ì •í•˜ê³ 
             // TradingView ìœ„ì ¯ì˜ 'autosize: true'ì— ì˜ì¡´í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤.
             // ì—¬ê¸°ì„œëŠ” 'loadCharts'ë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•˜ì—¬ ì™„ë²½í•˜ê²Œ ë¦¬ì‚¬ì´ì¦ˆë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
             // loadCharts(currentCoin); 
        });

    </script>
</body>
</html>