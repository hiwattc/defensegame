<!DOCTYPE html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¸êµ­ ì£¼ì‹ ì‹œì¥ ë§µ - ì‚°ì—…ë³„ Tree Map</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        color: #fff;
        padding: 20px;
    }

    .header {
        text-align: center;
        margin-bottom: 30px;
    }

    h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .subtitle {
        color: #8892b0;
        font-size: 1.1em;
    }

    .controls {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .control-btn {
        padding: 10px 20px;
        background: rgba(102, 126, 234, 0.2);
        border: 2px solid #667eea;
        color: #fff;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .control-btn:hover {
        background: rgba(102, 126, 234, 0.4);
        transform: translateY(-2px);
    }

    .control-btn.active {
        background: #667eea;
    }

    #chart-container {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
    }

    .loading {
        text-align: center;
        padding: 100px;
        font-size: 1.5em;
        color: #667eea;
    }

    .cell {
        cursor: pointer;
        transition: opacity 0.3s ease;
    }

    .cell:hover {
        opacity: 0.8;
        stroke: #fff;
        stroke-width: 3;
    }

    .cell-label {
        pointer-events: none;
        font-weight: 600;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    }

    .tooltip {
        position: absolute;
        background: rgba(0, 0, 0, 0.9);
        color: #fff;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 14px;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s;
        border: 1px solid #667eea;
        z-index: 1000;
        max-width: 300px;
    }

    .tooltip.show {
        opacity: 1;
    }

    .legend {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
    }

    .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 4px;
    }

    .stats {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .stat-item {
        text-align: center;
    }

    .stat-value {
        font-size: 2em;
        font-weight: bold;
        color: #667eea;
    }

    .stat-label {
        color: #8892b0;
        font-size: 0.9em;
        margin-top: 5px;
    }

    .last-update {
        text-align: center;
        color: #8892b0;
        font-size: 0.9em;
        margin-top: 15px;
    }
</style>
```

</head>
<body>
    <div class="header">
        <h1>ğŸ‡ºğŸ‡¸ US Stock Market Map</h1>
        <div class="subtitle">ì‹¤ì‹œê°„ ì‚°ì—…ë³„ ì‹œê°€ì´ì•¡ Tree Map</div>
    </div>

```
<div class="controls">
    <button class="control-btn active" onclick="updateView('marketCap')">ì‹œê°€ì´ì•¡</button>
    <button class="control-btn" onclick="updateView('change')">ë“±ë½ë¥ </button>
    <button class="control-btn" onclick="refreshData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
</div>

<div id="chart-container">
    <div class="loading" id="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
    <div id="chart"></div>
</div>

<div class="stats" id="stats"></div>
<div class="last-update" id="last-update"></div>

<div class="tooltip" id="tooltip"></div>

<script>
    let currentView = 'marketCap';
    let stockData = [];

    // ì£¼ìš” ë¯¸êµ­ ê¸°ì—… ë°ì´í„° (ì„¹í„°ë³„ ëŒ€í‘œ ê¸°ì—…ë“¤)
    const companies = {
        'Technology': [
            { symbol: 'AAPL', name: 'Apple' },
            { symbol: 'MSFT', name: 'Microsoft' },
            { symbol: 'GOOGL', name: 'Alphabet' },
            { symbol: 'META', name: 'Meta' },
            { symbol: 'NVDA', name: 'NVIDIA' },
            { symbol: 'TSLA', name: 'Tesla' },
            { symbol: 'AVGO', name: 'Broadcom' },
            { symbol: 'ORCL', name: 'Oracle' },
            { symbol: 'ADBE', name: 'Adobe' },
            { symbol: 'CRM', name: 'Salesforce' }
        ],
        'Healthcare': [
            { symbol: 'UNH', name: 'UnitedHealth' },
            { symbol: 'JNJ', name: 'Johnson & Johnson' },
            { symbol: 'LLY', name: 'Eli Lilly' },
            { symbol: 'ABBV', name: 'AbbVie' },
            { symbol: 'MRK', name: 'Merck' },
            { symbol: 'PFE', name: 'Pfizer' }
        ],
        'Financials': [
            { symbol: 'BRK-B', name: 'Berkshire Hathaway' },
            { symbol: 'JPM', name: 'JPMorgan Chase' },
            { symbol: 'V', name: 'Visa' },
            { symbol: 'MA', name: 'Mastercard' },
            { symbol: 'BAC', name: 'Bank of America' },
            { symbol: 'WFC', name: 'Wells Fargo' }
        ],
        'Consumer': [
            { symbol: 'AMZN', name: 'Amazon' },
            { symbol: 'WMT', name: 'Walmart' },
            { symbol: 'HD', name: 'Home Depot' },
            { symbol: 'MCD', name: "McDonald's" },
            { symbol: 'NKE', name: 'Nike' },
            { symbol: 'COST', name: 'Costco' }
        ],
        'Energy': [
            { symbol: 'XOM', name: 'Exxon Mobil' },
            { symbol: 'CVX', name: 'Chevron' },
            { symbol: 'COP', name: 'ConocoPhillips' },
            { symbol: 'SLB', name: 'Schlumberger' }
        ],
        'Industrials': [
            { symbol: 'BA', name: 'Boeing' },
            { symbol: 'UPS', name: 'UPS' },
            { symbol: 'HON', name: 'Honeywell' },
            { symbol: 'CAT', name: 'Caterpillar' }
        ],
        'Communication': [
            { symbol: 'NFLX', name: 'Netflix' },
            { symbol: 'DIS', name: 'Disney' },
            { symbol: 'CMCSA', name: 'Comcast' },
            { symbol: 'T', name: 'AT&T' }
        ]
    };

    // ìƒ‰ìƒ ìŠ¤ì¼€ì¼
    const sectorColors = {
        'Technology': '#667eea',
        'Healthcare': '#f093fb',
        'Financials': '#4facfe',
        'Consumer': '#43e97b',
        'Energy': '#fa709a',
        'Industrials': '#feca57',
        'Communication': '#ff6b6b'
    };

    // Yahoo Finance APIë¥¼ í†µí•œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    async function fetchStockData() {
        const loading = document.getElementById('loading');
        loading.style.display = 'block';
        
        stockData = [];
        
        for (const [sector, stocks] of Object.entries(companies)) {
            for (const stock of stocks) {
                try {
                    // Yahoo Finance API ëŒ€ì•ˆìœ¼ë¡œ ì‹¤ì œ ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜
                    // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” yfinance API ë˜ëŠ” Alpha Vantage ë“±ì„ ì‚¬ìš©
                    const data = await simulateStockData(stock.symbol, stock.name, sector);
                    stockData.push(data);
                    await sleep(50); // API í˜¸ì¶œ ì œí•œ ë°©ì§€
                } catch (error) {
                    console.error(`Error fetching ${stock.symbol}:`, error);
                }
            }
        }
        
        loading.style.display = 'none';
        renderChart();
        updateStats();
    }

    // ì‹¤ì œ API ëŒ€ì‹  í˜„ì‹¤ì ì¸ ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜
    async function simulateStockData(symbol, name, sector) {
        // ì‹¤ì œì™€ ìœ ì‚¬í•œ ì‹œê°€ì´ì•¡ ë²”ìœ„ (ì–µ ë‹¬ëŸ¬)
        const marketCapRanges = {
            'AAPL': [2800, 3200],
            'MSFT': [2600, 3000],
            'GOOGL': [1600, 1900],
            'AMZN': [1400, 1700],
            'NVDA': [1200, 2500],
            'META': [900, 1200],
            'TSLA': [600, 1000],
            'BRK-B': [800, 900],
            'UNH': [450, 550],
            'JNJ': [350, 450],
            'default': [50, 500]
        };

        const range = marketCapRanges[symbol] || marketCapRanges['default'];
        const marketCap = Math.random() * (range[1] - range[0]) + range[0];
        const change = (Math.random() - 0.5) * 10; // -5% ~ +5%
        const price = Math.random() * 500 + 50;

        return {
            symbol,
            name,
            sector,
            marketCap: marketCap * 1e9, // ë‹¬ëŸ¬ë¡œ ë³€í™˜
            price: price.toFixed(2),
            change: change.toFixed(2),
            volume: Math.floor(Math.random() * 100000000)
        };
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    function renderChart() {
        const container = document.getElementById('chart');
        container.innerHTML = '';

        const width = Math.min(1400, window.innerWidth - 80);
        const height = 700;

        // ë°ì´í„° êµ¬ì¡°í™”
        const hierarchyData = {
            name: 'US Stock Market',
            children: Object.keys(sectorColors).map(sector => ({
                name: sector,
                children: stockData
                    .filter(d => d.sector === sector)
                    .map(d => ({
                        ...d,
                        value: currentView === 'marketCap' ? d.marketCap : Math.abs(parseFloat(d.change))
                    }))
            }))
        };

        const root = d3.hierarchy(hierarchyData)
            .sum(d => d.value || 0)
            .sort((a, b) => b.value - a.value);

        const treemap = d3.treemap()
            .size([width, height])
            .paddingOuter(4)
            .paddingTop(25)
            .paddingInner(2)
            .round(true);

        treemap(root);

        const svg = d3.select('#chart')
            .append('svg')
            .attr('width', width)
            .attr('height', height);

        const tooltip = d3.select('#tooltip');

        // ì„¹í„° ê·¸ë£¹
        const nodes = svg.selectAll('g')
            .data(root.descendants().filter(d => d.depth === 1))
            .join('g')
            .attr('transform', d => `translate(${d.x0},${d.y0})`);

        // ì„¹í„° ë°°ê²½
        nodes.append('rect')
            .attr('width', d => d.x1 - d.x0)
            .attr('height', d => d.y1 - d.y0)
            .attr('fill', d => sectorColors[d.data.name])
            .attr('opacity', 0.1)
            .attr('rx', 8);

        // ì„¹í„° ë ˆì´ë¸”
        nodes.append('text')
            .attr('x', 8)
            .attr('y', 18)
            .attr('fill', '#fff')
            .attr('font-size', '14px')
            .attr('font-weight', 'bold')
            .text(d => d.data.name);

        // ê°œë³„ ì£¼ì‹ ì…€
        const cells = svg.selectAll('.cell')
            .data(root.leaves())
            .join('g')
            .attr('class', 'cell')
            .attr('transform', d => `translate(${d.x0},${d.y0})`);

        cells.append('rect')
            .attr('width', d => Math.max(0, d.x1 - d.x0))
            .attr('height', d => Math.max(0, d.y1 - d.y0))
            .attr('fill', d => {
                if (currentView === 'change') {
                    const change = parseFloat(d.data.change);
                    return change >= 0 ? '#10b981' : '#ef4444';
                }
                return sectorColors[d.parent.data.name];
            })
            .attr('opacity', d => {
                if (currentView === 'change') {
                    return Math.min(Math.abs(parseFloat(d.data.change)) / 5, 1);
                }
                return 0.8;
            })
            .attr('rx', 4);

        // ì£¼ì‹ ì‹¬ë³¼ í…ìŠ¤íŠ¸
        cells.append('text')
            .attr('class', 'cell-label')
            .attr('x', d => (d.x1 - d.x0) / 2)
            .attr('y', d => (d.y1 - d.y0) / 2 - 5)
            .attr('text-anchor', 'middle')
            .attr('fill', '#fff')
            .attr('font-size', d => {
                const width = d.x1 - d.x0;
                return Math.min(width / 4, 16) + 'px';
            })
            .text(d => d.data.symbol);

        // ê°€ê²© ë˜ëŠ” ë³€ë™ë¥  í…ìŠ¤íŠ¸
        cells.append('text')
            .attr('class', 'cell-label')
            .attr('x', d => (d.x1 - d.x0) / 2)
            .attr('y', d => (d.y1 - d.y0) / 2 + 12)
            .attr('text-anchor', 'middle')
            .attr('fill', '#fff')
            .attr('font-size', d => {
                const width = d.x1 - d.x0;
                return Math.min(width / 6, 12) + 'px';
            })
            .text(d => {
                if (currentView === 'change') {
                    return `${d.data.change}%`;
                }
                return `$${d.data.price}`;
            });

        // íˆ´íŒ ì´ë²¤íŠ¸
        cells.on('mouseover', function(event, d) {
            const change = parseFloat(d.data.change);
            const changeColor = change >= 0 ? '#10b981' : '#ef4444';
            
            tooltip.html(`
                <strong>${d.data.name} (${d.data.symbol})</strong><br/>
                ì„¹í„°: ${d.parent.data.name}<br/>
                í˜„ì¬ê°€: $${d.data.price}<br/>
                ë³€ë™ë¥ : <span style="color: ${changeColor}">${change >= 0 ? '+' : ''}${d.data.change}%</span><br/>
                ì‹œê°€ì´ì•¡: $${(d.data.marketCap / 1e9).toFixed(2)}B<br/>
                ê±°ë˜ëŸ‰: ${(d.data.volume / 1e6).toFixed(2)}M
            `)
                .classed('show', true)
                .style('left', (event.pageX + 10) + 'px')
                .style('top', (event.pageY - 10) + 'px');
        })
        .on('mouseout', function() {
            tooltip.classed('show', false);
        });
    }

    function updateStats() {
        const totalMarketCap = stockData.reduce((sum, d) => sum + d.marketCap, 0);
        const avgChange = stockData.reduce((sum, d) => sum + parseFloat(d.change), 0) / stockData.length;
        const gainers = stockData.filter(d => parseFloat(d.change) > 0).length;
        const losers = stockData.filter(d => parseFloat(d.change) < 0).length;

        const statsHtml = `
            <div class="stat-item">
                <div class="stat-value">$${(totalMarketCap / 1e12).toFixed(2)}T</div>
                <div class="stat-label">ì´ ì‹œê°€ì´ì•¡</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" style="color: ${avgChange >= 0 ? '#10b981' : '#ef4444'}">
                    ${avgChange >= 0 ? '+' : ''}${avgChange.toFixed(2)}%
                </div>
                <div class="stat-label">í‰ê·  ë“±ë½ë¥ </div>
            </div>
            <div class="stat-item">
                <div class="stat-value" style="color: #10b981">${gainers}</div>
                <div class="stat-label">ìƒìŠ¹ ì¢…ëª©</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" style="color: #ef4444">${losers}</div>
                <div class="stat-label">í•˜ë½ ì¢…ëª©</div>
            </div>
        `;

        document.getElementById('stats').innerHTML = statsHtml;
        document.getElementById('last-update').innerHTML = 
            `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date().toLocaleString('ko-KR')}`;
    }

    function updateView(view) {
        currentView = view;
        document.querySelectorAll('.control-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        renderChart();
    }

    function refreshData() {
        fetchStockData();
    }

    // ì´ˆê¸° ë¡œë“œ
    window.addEventListener('load', () => {
        fetchStockData();
    });

    // ë°˜ì‘í˜• ì²˜ë¦¬
    window.addEventListener('resize', () => {
        if (stockData.length > 0) {
            renderChart();
        }
    });
</script>
```

</body>
</html>