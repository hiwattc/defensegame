<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B2C ì´ì¤‘í™” Web/WAS/DB êµ¬ì„±ë„</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
        
        // Mermaid ë Œë”ë§ í›„ panzoom ì ìš©
        document.addEventListener('DOMContentLoaded', async () => {
            const mermaidElement = document.querySelector('.mermaid');
            if (mermaidElement) {
                await mermaid.run();
                
                // SVG ìš”ì†Œ ì°¾ê¸°
                const svg = mermaidElement.querySelector('svg');
                if (svg) {
                    // SVGë¥¼ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ ìƒì„±
                    const wrapper = document.createElement('div');
                    wrapper.className = 'mermaid-wrapper';
                    wrapper.style.cssText = 'overflow: hidden; position: relative; width: 100%; height: 600px; cursor: move;';
                    
                    // SVGë¥¼ ê°ì‹¸ëŠ” ë‚´ë¶€ ì»¨í…Œì´ë„ˆ ìƒì„± (ë³€í™˜ ì ìš©ìš©)
                    const inner = document.createElement('div');
                    inner.style.cssText = 'transform-origin: 0 0; transition: transform 0.2s ease-out;';
                    
                    // DOM êµ¬ì¡° ì„¤ì •
                    svg.parentNode.insertBefore(wrapper, svg);
                    wrapper.appendChild(inner);
                    inner.appendChild(svg);
                    
                    // SVG ìŠ¤íƒ€ì¼ ì¡°ì •
                    svg.style.display = 'block';
                    svg.style.width = '100%';
                    svg.style.height = 'auto';
                    
                    // ì¤Œ ì •ë³´ í‘œì‹œ ìš”ì†Œ ìƒì„±
                    const zoomInfo = document.createElement('div');
                    zoomInfo.className = 'zoom-info';
                    zoomInfo.textContent = 'ğŸ” ë§ˆìš°ìŠ¤ ë“œë˜ê·¸: ì´ë™ | íœ : í™•ëŒ€/ì¶•ì†Œ | ë”ë¸”í´ë¦­: ë¦¬ì…‹';
                    wrapper.appendChild(zoomInfo);
                    
                    // ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ìƒì„±
                    const controls = document.createElement('div');
                    controls.className = 'zoom-controls';
                    controls.innerHTML = `
                        <button class="zoom-btn" id="zoom-in" title="í™•ëŒ€">+</button>
                        <button class="zoom-btn" id="zoom-out" title="ì¶•ì†Œ">âˆ’</button>
                        <button class="zoom-btn" id="zoom-reset" title="ë¦¬ì…‹">âŒ‚</button>
                    `;
                    wrapper.appendChild(controls);
                    
                    // Pan & Zoom ìƒíƒœ
                    let scale = 1;
                    let panX = 0;
                    let panY = 0;
                    let isDragging = false;
                    let startX = 0;
                    let startY = 0;
                    let startPanX = 0;
                    let startPanY = 0;
                    
                    const minScale = 0.5;
                    const maxScale = 5;
                    const step = 0.1;
                    
                    // ë³€í™˜ ì ìš© í•¨ìˆ˜
                    const applyTransform = () => {
                        inner.style.transform = `translate(${panX}px, ${panY}px) scale(${scale})`;
                        zoomInfo.textContent = `ğŸ” ì¤Œ: ${(scale * 100).toFixed(0)}% | ë“œë˜ê·¸: ì´ë™ | íœ : í™•ëŒ€/ì¶•ì†Œ | ë”ë¸”í´ë¦­: ë¦¬ì…‹`;
                    };
                    
                    // ì¤Œ í•¨ìˆ˜
                    const zoom = (delta, centerX = null, centerY = null) => {
                        const oldScale = scale;
                        scale = Math.max(minScale, Math.min(maxScale, scale + delta));
                        
                        if (centerX !== null && centerY !== null) {
                            // ë§ˆìš°ìŠ¤ ìœ„ì¹˜ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì¤Œ
                            const rect = wrapper.getBoundingClientRect();
                            const x = centerX - rect.left;
                            const y = centerY - rect.top;
                            
                            panX = x - (x - panX) * (scale / oldScale);
                            panY = y - (y - panY) * (scale / oldScale);
                        }
                        
                        applyTransform();
                    };
                    
                    // ë¦¬ì…‹ í•¨ìˆ˜
                    const reset = () => {
                        scale = 1;
                        panX = 0;
                        panY = 0;
                        applyTransform();
                    };
                    
                    // ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ ì‹œì‘
                    wrapper.addEventListener('mousedown', (e) => {
                        if (e.button === 0) { // ì™¼ìª½ ë²„íŠ¼ë§Œ
                            isDragging = true;
                            startX = e.clientX;
                            startY = e.clientY;
                            startPanX = panX;
                            startPanY = panY;
                            wrapper.style.cursor = 'grabbing';
                        }
                    });
                    
                    // ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ ì¤‘
                    document.addEventListener('mousemove', (e) => {
                        if (isDragging) {
                            panX = startPanX + (e.clientX - startX);
                            panY = startPanY + (e.clientY - startY);
                            applyTransform();
                        }
                    });
                    
                    // ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ ì¢…ë£Œ
                    document.addEventListener('mouseup', () => {
                        if (isDragging) {
                            isDragging = false;
                            wrapper.style.cursor = 'move';
                        }
                    });
                    
                    // ë§ˆìš°ìŠ¤ íœ ë¡œ í™•ëŒ€/ì¶•ì†Œ
                    wrapper.addEventListener('wheel', (e) => {
                        e.preventDefault();
                        const delta = e.deltaY > 0 ? -step : step;
                        zoom(delta, e.clientX, e.clientY);
                    });
                    
                    // ë”ë¸”í´ë¦­ìœ¼ë¡œ ë¦¬ì…‹
                    wrapper.addEventListener('dblclick', (e) => {
                        e.preventDefault();
                        reset();
                    });
                    
                    // ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ì´ë²¤íŠ¸
                    document.getElementById('zoom-in').addEventListener('click', () => {
                        const rect = wrapper.getBoundingClientRect();
                        zoom(step, rect.left + rect.width / 2, rect.top + rect.height / 2);
                    });
                    
                    document.getElementById('zoom-out').addEventListener('click', () => {
                        const rect = wrapper.getBoundingClientRect();
                        zoom(-step, rect.left + rect.width / 2, rect.top + rect.height / 2);
                    });
                    
                    document.getElementById('zoom-reset').addEventListener('click', () => {
                        reset();
                    });
                    
                    // ì´ˆê¸° ë³€í™˜ ì ìš©
                    applyTransform();
                }
            }
        });
    </script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .mermaid {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
        }
        .mermaid-wrapper {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
        }
        .zoom-controls {
            position: absolute;
            top: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 10;
        }
        .zoom-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 5px;
            background: #667eea;
            color: white;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }
        .zoom-btn:hover {
            background: #5568d3;
            transform: scale(1.05);
        }
        .zoom-btn:active {
            transform: scale(0.95);
        }
        .zoom-info {
            position: absolute;
            top: 30px;
            left: 30px;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .legend {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        .legend h3 {
            margin-top: 0;
            color: #333;
        }
        .legend ul {
            list-style: none;
            padding: 0;
        }
        .legend li {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .legend li:last-child {
            border-bottom: none;
        }
        .legend strong {
            color: #667eea;
            display: inline-block;
            width: 150px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>B2C ì´ì¤‘í™” Web/WAS/DB ì•„í‚¤í…ì²˜ êµ¬ì„±ë„</h1>
        <p class="subtitle">100ëª… ì´ìƒ ë™ì ‘ ì§€ì› | ê³ ê°€ìš©ì„± ì´ì¤‘í™” êµ¬ì¡°</p>
        
        <div class="mermaid">
graph TB
    subgraph Internet["ğŸŒ ì¸í„°ë„·"]
        Users["ğŸ‘¥ ì‚¬ìš©ì<br/>(100+ ë™ì ‘)"]
    end
    
    subgraph DMZ["DMZ ì˜ì—­"]
        FW1["ğŸ”¥ FW-1<br/>Active"]
        FW2["ğŸ”¥ FW-2<br/>Standby"]
        WAF1["ğŸ›¡ï¸ WAF-1<br/>Active"]
        WAF2["ğŸ›¡ï¸ WAF-2<br/>Standby"]
        L4_1["âš–ï¸ L4-1<br/>Active"]
        L4_2["âš–ï¸ L4-2<br/>Standby"]
        Nginx1["ğŸŒ Nginx-1<br/>80/443"]
        Nginx2["ğŸŒ Nginx-2<br/>80/443"]
    end
    
    subgraph App["ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜ì—­"]
        Tomcat1["â˜• Tomcat-1<br/>8080<br/>Session Clustering"]
        Tomcat2["â˜• Tomcat-2<br/>8080<br/>Session Clustering"]
        JWT1["ğŸ” JWT SSO-1<br/>Token ë°œê¸‰/ê²€ì¦"]
        JWT2["ğŸ” JWT SSO-2<br/>Token ë°œê¸‰/ê²€ì¦"]
        AccountAPI["ğŸ‘¤ í†µí•©ê³„ì • API<br/>ì‚¬ìš©ì ì¸ì¦/ê¶Œí•œ"]
    end
    
    subgraph DB["ë°ì´í„°ë² ì´ìŠ¤ ì˜ì—­"]
        PG_Master["ğŸ˜ PostgreSQL<br/>Master Primary"]
        PG_Slave["ğŸ˜ PostgreSQL<br/>Slave Standby"]
    end
    
    Users -->|HTTPS| FW1
    Users -.->|Failover| FW2
    FW1 -.->|Heartbeat| FW2
    FW1 --> WAF1
    FW2 --> WAF2
    WAF1 -.->|Heartbeat| WAF2
    WAF1 --> L4_1
    WAF2 --> L4_2
    L4_1 -.->|VRRP| L4_2
    L4_1 -->|Load Balance| Nginx1
    L4_1 -->|Load Balance| Nginx2
    L4_2 -.->|Failover| L4_1
    
    Nginx1 -->|Reverse Proxy| Tomcat1
    Nginx1 -->|Reverse Proxy| Tomcat2
    Nginx2 -->|Reverse Proxy| Tomcat1
    Nginx2 -->|Reverse Proxy| Tomcat2
    
    Tomcat1 -->|JWT ê²€ì¦| JWT1
    Tomcat1 -->|JWT ê²€ì¦| JWT2
    Tomcat2 -->|JWT ê²€ì¦| JWT1
    Tomcat2 -->|JWT ê²€ì¦| JWT2
    
    JWT1 -->|ì‚¬ìš©ì ì •ë³´| AccountAPI
    JWT2 -->|ì‚¬ìš©ì ì •ë³´| AccountAPI
    
    Tomcat1 -->|Read/Write| PG_Master
    Tomcat2 -->|Read/Write| PG_Master
    Tomcat1 -.->|Read Only| PG_Slave
    Tomcat2 -.->|Read Only| PG_Slave
    PG_Master -->|Streaming Replication| PG_Slave
    
    classDef internet fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef dmz fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef app fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef db fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef active fill:#c8e6c9,stroke:#2e7d32,stroke-width:3px
    classDef standby fill:#ffecb3,stroke:#f57c00,stroke-width:2px
    
    class Users internet
    class FW1,FW2,WAF1,WAF2,L4_1,L4_2,Nginx1,Nginx2 dmz
    class Tomcat1,Tomcat2,JWT1,JWT2,AccountAPI app
    class PG_Master,PG_Slave db
    class FW1,WAF1,L4_1,PG_Master active
    class FW2,WAF2,L4_2,PG_Slave standby
        </div>
        
        <div class="legend">
            <h3>ğŸ“‹ êµ¬ì„± ìš”ì†Œ ì„¤ëª…</h3>
            <ul>
                <li><strong>Firewall (ì´ì¤‘í™”):</strong> ì™¸ë¶€ íŠ¸ë˜í”½ í•„í„°ë§, Active-Standby êµ¬ì„±ìœ¼ë¡œ ê³ ê°€ìš©ì„± ë³´ì¥</li>
                <li><strong>WAF (ì´ì¤‘í™”):</strong> ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³µê²© ë°©ì–´, SQL Injection, XSS ë“± ì°¨ë‹¨</li>
                <li><strong>L4 Load Balancer (ì´ì¤‘í™”):</strong> VRRP í”„ë¡œí† ì½œë¡œ ì´ì¤‘í™”, íŠ¸ë˜í”½ ë¶„ì‚° ë° ì¥ì•  ëŒ€ì‘</li>
                <li><strong>Nginx (ì´ì¤‘í™”):</strong> ì •ì  ë¦¬ì†ŒìŠ¤ ì„œë¹™, SSL/TLS ì¢…ë£Œ, Tomcatìœ¼ë¡œ Reverse Proxy</li>
                <li><strong>Tomcat (ì´ì¤‘í™”):</strong> Session Clusteringìœ¼ë¡œ ì„¸ì…˜ ê³µìœ , ë¡œë“œ ë°¸ëŸ°ì‹±</li>
                <li><strong>JWT SSO (ì´ì¤‘í™”):</strong> í† í° ê¸°ë°˜ ì¸ì¦, í†µí•©ê³„ì •ì‹œìŠ¤í…œê³¼ ì—°ë™í•˜ì—¬ ì‚¬ìš©ì ì¸ì¦/ê¶Œí•œ ê´€ë¦¬</li>
                <li><strong>í†µí•©ê³„ì •ì‹œìŠ¤í…œ:</strong> ì¤‘ì•™í™”ëœ ì‚¬ìš©ì ê³„ì • ë° ê¶Œí•œ ê´€ë¦¬ ì‹œìŠ¤í…œ</li>
                <li><strong>PostgreSQL (ì´ì¤‘í™”):</strong> Streaming Replicationìœ¼ë¡œ Master-Slave êµ¬ì„±, ì½ê¸° ë¶„ì‚° ë° ì¥ì•  ëŒ€ì‘</li>
            </ul>
            
            <h3>ğŸ”’ ë³´ì•ˆ ë° ê³ ê°€ìš©ì„± íŠ¹ì§•</h3>
            <ul>
                <li><strong>ì´ì¤‘í™” êµ¬ì¡°:</strong> ëª¨ë“  ì£¼ìš” êµ¬ì„±ìš”ì†Œê°€ Active-Standby ë˜ëŠ” Active-Activeë¡œ êµ¬ì„±ë˜ì–´ ë‹¨ì¼ ì¥ì• ì (SPOF) ì œê±°</li>
                <li><strong>ì„¸ì…˜ í´ëŸ¬ìŠ¤í„°ë§:</strong> Tomcat ê°„ ì„¸ì…˜ ê³µìœ ë¡œ ì„œë²„ ì¥ì•  ì‹œì—ë„ ì‚¬ìš©ì ì„¸ì…˜ ìœ ì§€</li>
                <li><strong>ì½ê¸° ë¶„ì‚°:</strong> PostgreSQL Slaveë¥¼ í†µí•œ ì½ê¸° ë¶€í•˜ ë¶„ì‚°</li>
                <li><strong>JWT ê¸°ë°˜ SSO:</strong> ë¬´ìƒíƒœ(Stateless) ì¸ì¦ìœ¼ë¡œ í™•ì¥ì„± ë° ì„±ëŠ¥ í–¥ìƒ</li>
                <li><strong>í†µí•©ê³„ì • ì—°ë™:</strong> ì¤‘ì•™í™”ëœ ì¸ì¦ìœ¼ë¡œ ë³´ì•ˆ ê°•í™” ë° ê´€ë¦¬ íš¨ìœ¨ì„± í–¥ìƒ</li>
            </ul>
        </div>
    </div>
</body>
</html>
