<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>4ì¶• ë°”í€´ ëŒ€í˜• íŠ¸ë™ ë ˆì´ì‹± ê²Œì„</title>
  <style>
    body { margin: 0; background: #222; color: #fff; 
            padding-top: 80px;
        }
    #ui { position: absolute; top: 10px; left: 10px; z-index: 10; font-family: sans-serif; }
    canvas { display: block; margin: 0 auto; background: #333; }
          
        .hashtag-menu {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px;
            z-index: 1000;
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .hashtag-item {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            margin: 4px 6px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .hashtag-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4c93 100%);
        }
        
        .hashtag-item.current {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
        }
        
        .hashtag-category {
            display: inline-block;
            margin: 0 10px;
        }
        
        .category-title {
            color: #ccc;
            font-size: 12px;
            margin-right: 5px;
        }
            
        /* í•´ì‹œíƒœê·¸ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
        .hashtag-menu {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px;
            z-index: 1000;
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .hashtag-item {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            margin: 4px 6px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .hashtag-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4c93 100%);
        }
        
        .hashtag-item.current {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
        }
        
        .hashtag-category {
            display: inline-block;
            margin: 0 10px;
        }
        
        .category-title {
            color: #ccc;
            font-size: 12px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <!-- í•´ì‹œíƒœê·¸ ë©”ë‰´ -->
    <div class="hashtag-menu">
        <div class="hashtag-category">
            <span class="category-title">ğŸ® ì•¡ì…˜</span>
            <a href="index.html" class="hashtag-item">#3DìŠˆíŒ…</a>
            <a href="def1.html" class="hashtag-item">#ì„±ë°©ì–´</a>
            <a href="bomb.html" class="hashtag-item">#í­íƒ„ê²Œì„</a>
            <a href="bomb2.html" class="hashtag-item">#í­íƒ„2</a>
            <a href="arrow1.html" class="hashtag-item">#í™”ì‚´ì˜ê¸°</a>
            <a href="tire1.html" class="hashtag-item">#íƒ€ì´ì–´êµ´ë¦¬ê¸°</a>
        </div>
        <div class="hashtag-category">
            <span class="category-title">ğŸš€ ì‹œë®¬ë ˆì´ì…˜</span>
            <a href="game1.html" class="hashtag-item">#ë¡œì¼“ì°©ë¥™</a>
            <a href="tank1.html" class="hashtag-item">#íƒ±í¬ì „íˆ¬</a>
            <a href="tank2.html" class="hashtag-item">#íƒ±í¬ì „íˆ¬2</a>
            <a href="tank3.html" class="hashtag-item">#íƒ±í¬ì „íˆ¬3</a>
            <a href="tank5.html" class="hashtag-item">#íƒ±í¬ì „íˆ¬5</a>
            <a href="spacex.html" class="hashtag-item">#ìŠ¤í˜ì´ìŠ¤X</a>
            <a href="rocket1.html" class="hashtag-item">#ë¡œì¼“1</a>
            <a href="rocket2.html" class="hashtag-item">#ë¡œì¼“2</a>
            <a href="plain.html" class="hashtag-item">#ë³µì—½ê¸°</a>
            <a href="formula1.html" class="hashtag-item">#F1ë ˆì´ì‹±</a>
        </div>
        <div class="hashtag-category">
            <span class="category-title">ğŸ§© í¼ì¦</span>
            <a href="sliding-puzzle.html" class="hashtag-item">#ìŠ¬ë¼ì´ë”©í¼ì¦</a>
            <a href="1to100.html" class="hashtag-item">#1to100</a>
            <a href="numbermove.html" class="hashtag-item">#ìˆ«ìì´ë™</a>
        </div>
        <div class="hashtag-category">
            <span class="category-title">âš¾ ìŠ¤í¬ì¸ </span>
            <a href="baseball.html" class="hashtag-item">#ì•¼êµ¬ê²Œì„</a>
            <a href="bowl.html" class="hashtag-item">#ë³¼ë§</a>
            <a href="bowl2.html" class="hashtag-item">#ë¸”ëŸ­ë¹Œë”©</a>
            <a href="bowl3.html" class="hashtag-item">#í…ŒíŠ¸ë¦¬ìŠ¤</a>
            <a href="bowl4.html" class="hashtag-item">#ì•µê·¸ë¦¬ë²„ë“œ</a>
            <a href="bowl5.html" class="hashtag-item">#ì•µê·¸ë¦¬ë²„ë“œ2</a>
            <a href="bowlike.html" class="hashtag-item">#ë³¼ë§ê²Œì„</a>
            <a href="jump1.html" class="hashtag-item">#êµ¬ë¦„ì í”„</a>
            <a href="run1.html" class="hashtag-item">#í—ˆë“¤ë‹¬ë¦¬ê¸°</a>
            <a href="run2.html" class="hashtag-item">#ë§í—ˆë“¤</a>
        </div>
        <div class="hashtag-category">
            <span class="category-title">ğŸš— ë“œë¼ì´ë¹™</span>
            <a href="parking1.html" class="hashtag-item">#ì£¼ì°¨ê²Œì„1</a>
            <a href="parking2.html" class="hashtag-item">#ì£¼ì°¨ê²Œì„2</a>
            <a href="parking3.html" class="hashtag-item current">#ë ˆì´ì‹±ê²Œì„</a>
        </div>
        <div class="hashtag-category">
            <span class="category-title">ğŸ—ºï¸ RPG</span>
            <a href="open1.html" class="hashtag-item">#ì˜¤í”ˆì›”ë“œ</a>
            <a href="open2.html" class="hashtag-item">#íƒ±í¬ë””íœìŠ¤</a>
            <a href="open3.html" class="hashtag-item">#íƒ±í¬ì „íˆ¬RPG</a>
            <a href="open3d1.html" class="hashtag-item">#ìˆ²ì†íƒí—˜</a>
        </div>
        <div class="hashtag-category">
            <span class="category-title">ğŸ“ ìƒì‚°ì„±</span>
            <a href="JBTODO_V3.html" class="hashtag-item">#TODO_V3</a>
            <a href="JBTODO_V2.html" class="hashtag-item">#TODO_V2</a>
            <a href="JBTODO_V1.html" class="hashtag-item">#TODO_V1</a>
            <a href="webfiddler.html" class="hashtag-item">#ì›¹ë¶„ì„ë„êµ¬</a>
            <a href="websiteanal.html" class="hashtag-item">#ë³´ì•ˆí—¤ë”</a>
            <a href="gitstudy1.html" class="hashtag-item">#Gití•™ìŠµ</a>
        </div>
    </div>
    
    <div class="hashtag-category">
            <span class="category-title">ğŸš€ ì‹œë®¬ë ˆì´ì…˜</span>
            <a href="game1.html" class="hashtag-item">#ë¡œì¼“</a>
            <a href="tank1.html" class="hashtag-item">#íƒ±í¬</a>
            <a href="tank3.html" class="hashtag-item">#íƒ±í¬3</a>
            <a href="spacex.html" class="hashtag-item">#ìŠ¤í˜ì´ìŠ¤X</a>
        </div>
        <div class="hashtag-category">
            <span class="category-title">ğŸ§© í¼ì¦</span>
            <a href="sliding-puzzle.html" class="hashtag-item">#ìŠ¬ë¼ì´ë”©</a>
            <a href="1to100.html" class="hashtag-item">#1to100</a>
            <a href="numbermove.html" class="hashtag-item">#ìˆ«ìì´ë™</a>
        </div>
        <div class="hashtag-category">
            <span class="category-title">âš¾ ìŠ¤í¬ì¸ </span>
            <a href="baseball.html" class="hashtag-item">#ì•¼êµ¬</a>
            <a href="bowl.html" class="hashtag-item">#ë³¼ë§</a>
            <a href="jump1.html" class="hashtag-item">#ì í”„</a>
        </div>
        <div class="hashtag-category">
            <span class="category-title">ğŸš— ë“œë¼ì´ë¹™</span>
            <a href="parking1.html" class="hashtag-item">#ì£¼ì°¨1</a>
            <a href="parking2.html" class="hashtag-item">#ì£¼ì°¨2</a>
            <a href="parking3.html" class="hashtag-item current">#ì£¼ì°¨3</a>
        </div>
        <div class="hashtag-category">
            <span class="category-title">ğŸ“ ìƒì‚°ì„±</span>
            <a href="JBTODO_V3.html" class="hashtag-item">#TODO</a>
            <a href="webfiddler.html" class="hashtag-item">#ì›¹ë„êµ¬</a>
        </div>
    </div>
    
  <div id="ui"></div>
  <canvas id="game" width="1000" height="750"></canvas>
  <script>
// --- ìƒìˆ˜ ë° ì„¤ì • ---
const WORLD_WIDTH = 4000;
const WORLD_HEIGHT = 3000;
const TRACK_CENTER = { x: 2000, y: 1500 };
const TRACK_RADIUS_X = 1600;
const TRACK_RADIUS_Y = 1000;
const TRACK_WIDTH = 180;
const NUM_CHECKPOINTS = 12;
const NUM_AI = 5;
const CAR_RADIUS = 16;
const CAR_LENGTH = CAR_RADIUS * 4; // ê¸°ì¡´ë³´ë‹¤ 2ë°° ê¸¸ì´
const CAR_WIDTH = CAR_RADIUS * 2 * 0.8;
const COLORS = ["#ff4444", "#44ff44", "#4444ff", "#ffff44", "#44ffff", "#ff44ff"];

// --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
function clamp(val, min, max) { return Math.max(min, Math.min(max, val)); }
function dist(x1, y1, x2, y2) { return Math.hypot(x1 - x2, y1 - y2); }
function lerp(a, b, t) { return a + (b - a) * t; }

// --- íŠ¸ë™ ìœ„ ì—¬ë¶€ íŒì • ---
function isOnTrack(x, y) {
  const dx = x - TRACK_CENTER.x;
  const dy = y - TRACK_CENTER.y;
  const d = (dx * dx) / ((TRACK_RADIUS_X) * (TRACK_RADIUS_X)) + (dy * dy) / ((TRACK_RADIUS_Y) * (TRACK_RADIUS_Y));
  const dInner = (dx * dx) / ((TRACK_RADIUS_X - TRACK_WIDTH) * (TRACK_RADIUS_X - TRACK_WIDTH)) + (dy * dy) / ((TRACK_RADIUS_Y - TRACK_WIDTH) * (TRACK_RADIUS_Y - TRACK_WIDTH));
  // íŠ¸ë™ ê²½ê³„ì— ê°€ê¹Œìš´ì§€ ì—¬ë¶€ë„ ë°˜í™˜
  return { on: d <= 1 && dInner >= 1, outer: d > 1, inner: dInner < 1 };
}

// --- ì²´í¬í¬ì¸íŠ¸ í´ë˜ìŠ¤ ---
class Checkpoint {
  constructor(index) {
    this.index = index;
    const angle = (index / NUM_CHECKPOINTS) * 2 * Math.PI;
    this.x = TRACK_CENTER.x + Math.cos(angle) * (TRACK_RADIUS_X - TRACK_WIDTH / 2);
    this.y = TRACK_CENTER.y + Math.sin(angle) * (TRACK_RADIUS_Y - TRACK_WIDTH / 2);
    this.passedCars = new Set();
  }
  draw(ctx, camera) {
    ctx.save();
    ctx.strokeStyle = "#fff";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.arc(this.x - camera.x, this.y - camera.y, 40, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.restore();
  }
}

// --- ìë™ì°¨ í´ë˜ìŠ¤ ---
class Car {
  constructor(x, y, angle, color, isPlayer = false) {
    this.x = x;
    this.y = y;
    this.angle = angle;
    this.speed = 0;
    this.color = color;
    this.isPlayer = isPlayer;
    this.lap = 0;
    this.checkpoint = 0;
    this.distance = 0;
    this.gear = 1;
    this.name = isPlayer ? "í”Œë ˆì´ì–´" : "AI";
    this.vx = 0;
    this.vy = 0;
    this._lastSteer = 0;
  }
  update(input, checkpoints) {
    // ì…ë ¥ ì²˜ë¦¬
    let accel = 0, steer = 0;
    let drifting = false;
    if (this.isPlayer) {
      if (input["ArrowUp"]) accel = 0.4;
      if (input["ArrowDown"]) accel = -0.3;
      if (input["ArrowLeft"]) steer = -0.01125;
      if (input["ArrowRight"]) steer = 0.01125;
      // ìŠ¤í˜ì´ìŠ¤ë°”: ë¸Œë ˆì´í¬ ë° ë“œë¦¬í”„íŠ¸
      if (input[" "] || input["Spacebar"] || input[" "] === true) {
        // ê°•í•œ ë¸Œë ˆì´í¬
        if (Math.abs(this.speed) > 1.5) {
          drifting = true;
          this.speed *= 0.93; // ì†ë„ ê¸‰ê°
          // ë“œë¦¬í”„íŠ¸: ë’·ë°”í€´ê°€ ë¯¸ë„ëŸ¬ì§€ëŠ” íš¨ê³¼(ì°¨ëŸ‰ ê°ë„ì™€ ì§„í–‰ë°©í–¥ ì°¨ì´)
          // ì§„í–‰ë°©í–¥ê³¼ ì°¨ì²´ ê°ë„ ì°¨ì´ë¥¼ ë§Œë“¤ì–´ì¤Œ
          let driftAngle = steer * 2.5 * (this.speed > 0 ? 1 : -1);
          this.angle += driftAngle;
          // ë“œë¦¬í”„íŠ¸ì‹œ ì‚´ì§ ì˜†ìœ¼ë¡œ ë¯¸ë„ëŸ¬ì§
          this.x += Math.cos(this.angle + Math.PI/2) * Math.abs(this.speed) * 0.12;
          this.y += Math.sin(this.angle + Math.PI/2) * Math.abs(this.speed) * 0.12;
        } else {
          this.speed *= 0.85; // ì €ì†ì—ì„œëŠ” ê·¸ëƒ¥ ê°•í•œ ë¸Œë ˆì´í¬
        }
      }
    } else {
      // AI ê°œì„ : ë‹¤ìŒ ì²´í¬í¬ì¸íŠ¸ì™€ì˜ ê°ë„ ì°¨ì´ê°€ í¬ë©´ ê°ì†, ê°€ê¹Œìš°ë©´ ë‹¤ìŒ ì²´í¬í¬ì¸íŠ¸ë¡œ ë¯¸ë¦¬ ëª©í‘œ ë³€ê²½
      const cp = checkpoints[this.checkpoint % checkpoints.length];
      const dx = cp.x - this.x;
      const dy = cp.y - this.y;
      const distToCP = Math.hypot(dx, dy);
      const targetAngle = Math.atan2(dy, dx);
      let da = ((targetAngle - this.angle + Math.PI * 3) % (Math.PI * 2)) - Math.PI;
      // ì¡°í–¥ ê°ë„ ì¦ê°€(ë” ë¯¼ì²©í•˜ê²Œ)
      steer = clamp(da, -0.0175, 0.0175);
      // ê°ë„ ì°¨ì´ê°€ í¬ë©´ ê°ì†, ì‘ìœ¼ë©´ ê°€ì†
      if (Math.abs(da) > 0.5) {
        accel = 0.1;
      } else {
        accel = 0.28;
      }
      // ì²´í¬í¬ì¸íŠ¸ì— ê°€ê¹Œìš°ë©´ ë¯¸ë¦¬ ë‹¤ìŒ ì²´í¬í¬ì¸íŠ¸ë¡œ ëª©í‘œ ë³€ê²½
      if (distToCP < 80) {
        this.checkpoint++;
      }
    }
    this._lastSteer = steer; // drawì—ì„œ ì•ë°”í€´ êº¾ì„ì— ì‚¬ìš©
    this.angle += steer * (this.speed > 0 ? 1 : -1);
    this.speed += accel;
    this.speed *= 0.99; // ê´€ì„± 2ë°°(ë§ˆì°° ê°ì†Œ)
    this.speed = clamp(this.speed, -3, 8); // ìµœê³ ì†ë„ ì ˆë°˜ìœ¼ë¡œ ê°ì†Œ
    // ì´ë™
    this.vx = Math.cos(this.angle) * this.speed;
    this.vy = Math.sin(this.angle) * this.speed;
    this.x += this.vx;
    this.y += this.vy;
    // íŠ¸ë™ ê²½ê³„ ì¶©ëŒ ì²˜ë¦¬
    const trackStatus = isOnTrack(this.x, this.y);
    if (!trackStatus.on) {
      // íŠ¸ë™ ë°”ê¹¥ìª½ ê²½ê³„ ì¶©ëŒ
      const dx = this.x - TRACK_CENTER.x;
      const dy = this.y - TRACK_CENTER.y;
      let normX, normY;
      if (trackStatus.outer) {
        // ë°”ê¹¥ ê²½ê³„ì— ë‹¿ìŒ: íƒ€ì› ë°”ê¹¥ìª½ ë…¸ë©€
        const len = Math.hypot(dx / TRACK_RADIUS_X, dy / TRACK_RADIUS_Y);
        normX = (dx / TRACK_RADIUS_X) / len;
        normY = (dy / TRACK_RADIUS_Y) / len;
        // ìœ„ì¹˜ë¥¼ ê²½ê³„ì„  ìœ„ë¡œ ë³´ì •
        this.x = TRACK_CENTER.x + normX * TRACK_RADIUS_X;
        this.y = TRACK_CENTER.y + normY * TRACK_RADIUS_Y;
      } else if (trackStatus.inner) {
        // ì•ˆìª½ ê²½ê³„ì— ë‹¿ìŒ: íƒ€ì› ì•ˆìª½ ë…¸ë©€
        const len = Math.hypot(dx / (TRACK_RADIUS_X - TRACK_WIDTH), dy / (TRACK_RADIUS_Y - TRACK_WIDTH));
        normX = (dx / (TRACK_RADIUS_X - TRACK_WIDTH)) / len;
        normY = (dy / (TRACK_RADIUS_Y - TRACK_WIDTH)) / len;
        // ìœ„ì¹˜ë¥¼ ê²½ê³„ì„  ìœ„ë¡œ ë³´ì •
        this.x = TRACK_CENTER.x + normX * (TRACK_RADIUS_X - TRACK_WIDTH);
        this.y = TRACK_CENTER.y + normY * (TRACK_RADIUS_Y - TRACK_WIDTH);
      }
      // ì†ë„ ë°˜ë°œ(íŠ•ê¹€)
      const dot = this.vx * normX + this.vy * normY;
      const bounce = 1.5; // ë” ê°•í•œ ë°˜ë°œë ¥
      this.vx -= 2 * dot * normX * bounce;
      this.vy -= 2 * dot * normY * bounce;
      this.speed = Math.hypot(this.vx, this.vy) * 0.9;
    }
    // ì²´í¬í¬ì¸íŠ¸ í†µê³¼
    const cp = checkpoints[this.checkpoint % checkpoints.length];
    if (dist(this.x, this.y, cp.x, cp.y) < 60 && !cp.passedCars.has(this)) {
      cp.passedCars.add(this);
      this.checkpoint++;
      if (this.checkpoint % checkpoints.length === 0) {
        this.lap++;
      }
    }
    // ì´ ì´ë™ê±°ë¦¬
    this.distance += Math.abs(this.speed);
  }
  draw(ctx, camera) {
    ctx.save();
    ctx.translate(this.x - camera.x, this.y - camera.y);
    ctx.rotate(this.angle);
    // 4ê°œ íƒ€ì´ì–´ë§Œ ë³´ì´ê²Œ, ì•ë°”í€´ëŠ” ì¡°í–¥ê°ì— ë”°ë¼ êº¾ì„
    const w = CAR_WIDTH;
    const l = CAR_LENGTH;
    const tireW = 8, tireH = 16;
    const tireOffsetX = l/2 - 8;
    const tireOffsetY = w/2 - 6;
    // ì•ë°”í€´ ì¡°í–¥ê° ê³„ì‚°
    let steerDraw = 0;
    if (this.isPlayer) {
      if (input["ArrowLeft"]) steerDraw = -0.01125;
      if (input["ArrowRight"]) steerDraw = 0.01125;
    } else {
      steerDraw = this._lastSteer || 0;
    }
    // ì• ì™¼ìª½ íƒ€ì´ì–´
    ctx.save();
    ctx.translate(-tireOffsetX, -tireOffsetY);
    ctx.rotate(steerDraw * 2.5); // ì‹œê°ì ìœ¼ë¡œ ë” êº¾ì´ê²Œ
    ctx.fillStyle = "#222";
    ctx.fillRect(-tireW/2, -tireH/2, tireW, tireH);
    ctx.restore();
    // ì• ì˜¤ë¥¸ìª½ íƒ€ì´ì–´
    ctx.save();
    ctx.translate(-tireOffsetX, tireOffsetY);
    ctx.rotate(steerDraw * 2.5);
    ctx.fillStyle = "#222";
    ctx.fillRect(-tireW/2, -tireH/2, tireW, tireH);
    ctx.restore();
    // ë’¤ ì™¼ìª½ íƒ€ì´ì–´
    ctx.save();
    ctx.translate(tireOffsetX, -tireOffsetY);
    ctx.fillStyle = "#222";
    ctx.fillRect(-tireW/2, -tireH/2, tireW, tireH);
    ctx.restore();
    // ë’¤ ì˜¤ë¥¸ìª½ íƒ€ì´ì–´
    ctx.save();
    ctx.translate(tireOffsetX, tireOffsetY);
    ctx.fillStyle = "#222";
    ctx.fillRect(-tireW/2, -tireH/2, tireW, tireH);
    ctx.restore();
    // ì°¨ì²´
    ctx.fillStyle = this.color;
    ctx.fillRect(-l/2, -w/2, l, w);
    ctx.fillStyle = "#222";
    ctx.fillRect(0, -w/2, l/2, w);
    ctx.restore();
  }
  reset(x, y, angle) {
    this.x = x;
    this.y = y;
    this.angle = angle;
    this.speed = 0;
    this.lap = 0;
    this.checkpoint = 0;
    this.distance = 0;
  }
}

// --- íŠ¸ë™ ê·¸ë¦¬ê¸° ---
function drawRoad(ctx, camera) {
  ctx.save();
  ctx.translate(-camera.x, -camera.y);
  // íŠ¸ë™ ë°”ë‹¥(ê°ˆìƒ‰)
  ctx.beginPath();
  ctx.ellipse(TRACK_CENTER.x, TRACK_CENTER.y, TRACK_RADIUS_X - TRACK_WIDTH / 2, TRACK_RADIUS_Y - TRACK_WIDTH / 2, 0, 0, 2 * Math.PI);
  ctx.fillStyle = "#a67c52";
  ctx.fill();
  // íŠ¸ë™ ì™¸ê³½(íšŒìƒ‰ ë‘êº¼ìš´ ì„ )
  ctx.beginPath();
  ctx.ellipse(TRACK_CENTER.x, TRACK_CENTER.y, TRACK_RADIUS_X, TRACK_RADIUS_Y, 0, 0, 2 * Math.PI);
  ctx.lineWidth = TRACK_WIDTH;
  ctx.strokeStyle = "#888";
  ctx.stroke();
  // íŠ¸ë™ ê²½ê³„ì„ (ì ìƒ‰ ì ì„ ) - ë°”ê¹¥ìª½
  ctx.beginPath();
  ctx.ellipse(TRACK_CENTER.x, TRACK_CENTER.y, TRACK_RADIUS_X, TRACK_RADIUS_Y, 0, 0, 2 * Math.PI);
  ctx.setLineDash([16, 16]);
  ctx.lineWidth = 4;
  ctx.strokeStyle = "#ff4444";
  ctx.stroke();
  // íŠ¸ë™ ê²½ê³„ì„ (ì ìƒ‰ ì ì„ ) - ì•ˆìª½
  ctx.beginPath();
  ctx.ellipse(TRACK_CENTER.x, TRACK_CENTER.y, TRACK_RADIUS_X - TRACK_WIDTH, TRACK_RADIUS_Y - TRACK_WIDTH, 0, 0, 2 * Math.PI);
  ctx.setLineDash([16, 16]);
  ctx.lineWidth = 4;
  ctx.strokeStyle = "#ff4444";
  ctx.stroke();
  ctx.setLineDash([]);
  // ì¤‘ì•™ì„ 
  ctx.beginPath();
  ctx.ellipse(TRACK_CENTER.x, TRACK_CENTER.y, TRACK_RADIUS_X - TRACK_WIDTH/2, TRACK_RADIUS_Y - TRACK_WIDTH/2, 0, 0, 2 * Math.PI);
  ctx.setLineDash([40, 40]);
  ctx.lineWidth = 6;
  ctx.strokeStyle = "#fff";
  ctx.stroke();
  ctx.setLineDash([]);
  ctx.restore();
}

// --- ì¹´ë©”ë¼ ---
function updateCamera(camera, player) {
  camera.x = clamp(player.x - canvas.width/2, 0, WORLD_WIDTH - canvas.width);
  camera.y = clamp(player.y - canvas.height/2, 0, WORLD_HEIGHT - canvas.height);
}

// --- ìë™ì°¨ ì¶©ëŒ ì²˜ë¦¬ ---
function handleCollisions(cars) {
  for (let i = 0; i < cars.length; i++) {
    for (let j = i + 1; j < cars.length; j++) {
      const a = cars[i], b = cars[j];
      const d = dist(a.x, a.y, b.x, b.y);
      if (d < CAR_RADIUS * 1.5) {
        // ë°˜ë°œë ¥
        const nx = (b.x - a.x) / d;
        const ny = (b.y - a.y) / d;
        const overlap = CAR_RADIUS * 1.5 - d;
        a.x -= nx * overlap/2;
        a.y -= ny * overlap/2;
        b.x += nx * overlap/2;
        b.y += ny * overlap/2;
        // ì†ë„ ë°˜ë°œ
        const va = a.vx * nx + a.vy * ny;
        const vb = b.vx * nx + b.vy * ny;
        const bounce = 0.7;
        a.vx -= (va - vb) * nx * bounce;
        a.vy -= (va - vb) * ny * bounce;
        b.vx += (va - vb) * nx * bounce;
        b.vy += (va - vb) * ny * bounce;
      }
    }
  }
}

// --- UI ---
function drawUI(player, cars, checkpoints) {
  const ui = document.getElementById("ui");
  // ìˆœìœ„ ê³„ì‚°
  const sorted = [...cars].sort((a, b) => b.lap * 10000 + b.checkpoint - (a.lap * 10000 + a.checkpoint));
  const rank = sorted.indexOf(player) + 1;
  ui.innerHTML = `
    <b>ì†ë„:</b> ${player.speed.toFixed(1)}<br>
    <b>ê¸°ì–´:</b> ${player.gear}<br>
    <b>ë©:</b> ${player.lap}<br>
    <b>ìˆœìœ„:</b> ${rank} / ${cars.length}<br>
    <b>ì²´í¬í¬ì¸íŠ¸:</b> ${player.checkpoint % checkpoints.length + 1} / ${checkpoints.length}
  `;
}

// --- ê²Œì„ ì´ˆê¸°í™” ---
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let camera = { x: 0, y: 0 };
let input = {};
let checkpoints = [];
let cars = [];

function init() {
  checkpoints = [];
  for (let i = 0; i < NUM_CHECKPOINTS; i++) {
    checkpoints.push(new Checkpoint(i));
  }
  cars = [];
  // í”Œë ˆì´ì–´ ìë™ì°¨
  let angle0 = 0;
  let px = TRACK_CENTER.x + Math.cos(angle0) * (TRACK_RADIUS_X - TRACK_WIDTH / 2);
  let py = TRACK_CENTER.y + Math.sin(angle0) * (TRACK_RADIUS_Y - TRACK_WIDTH / 2);
  cars.push(new Car(px, py, Math.PI / 2, COLORS[0], true));
  // AI ìë™ì°¨
  for (let i = 1; i <= NUM_AI; i++) {
    let angle = i * 2 * Math.PI / (NUM_AI + 1);
    let x = TRACK_CENTER.x + Math.cos(angle) * (TRACK_RADIUS_X - TRACK_WIDTH / 2);
    let y = TRACK_CENTER.y + Math.sin(angle) * (TRACK_RADIUS_Y - TRACK_WIDTH / 2);
    cars.push(new Car(x, y, Math.PI / 2, COLORS[i % COLORS.length], false));
  }
}

// --- ì…ë ¥ ì²˜ë¦¬ ---
window.addEventListener("keydown", e => input[e.key] = true);
window.addEventListener("keyup", e => input[e.key] = false);

// --- ê²Œì„ ë£¨í”„ ---
function gameLoop() {
  // ì—…ë°ì´íŠ¸
  for (const car of cars) {
    car.update(input, checkpoints);
  }
  handleCollisions(cars);
  updateCamera(camera, cars[0]);
  // ê·¸ë¦¬ê¸°
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawRoad(ctx, camera);
  for (const cp of checkpoints) cp.draw(ctx, camera);
  for (const car of cars) car.draw(ctx, camera);
  drawUI(cars[0], cars, checkpoints);
  requestAnimationFrame(gameLoop);
}

init();
gameLoop();
  </script>
</body>
</html>
